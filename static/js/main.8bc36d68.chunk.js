(this["webpackJsonpreact-flight-search"]=this["webpackJsonpreact-flight-search"]||[]).push([[0],{15:function(t,e,a){},17:function(t,e,a){"use strict";a.r(e);var n=a(0),r=a.n(n),i=a(8),s=a.n(i),c=a(2),o=a(3),l=a(4),u=a(5),h=(a(14),a(15),a(1)),m=a.n(h),d=a(6),p=function t(){var e=this;Object(c.a)(this,t),this.getData=function(){var t=Object(d.a)(m.a.mark((function t(e){var a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e);case 2:if((a=t.sent).ok){t.next=5;break}throw new Error("Could not fetch ".concat(e,"; received ").concat(a.status));case 5:return t.next=7,a.json();case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.getCity=Object(d.a)(m.a.mark((function t(){var a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getData(e.PROXY+e.CITY_API);case 2:return a=t.sent,t.abrupt("return",a.filter((function(t){return t.name})));case 4:case"end":return t.stop()}}),t)}))),this.getPrice=function(){var t=Object(d.a)(m.a.mark((function t(a){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getData(e.calendar+a);case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.CITY_API="http://api.travelpayouts.com/data/ru/cities.json",this.CITY_API2="../dataBase/cities.json",this.PROXY="https://cors-anywhere.herokuapp.com/",this.API_KEY="6af464c149023c58b81e81ab93488992",this.calendar="https://min-prices.aviasales.ru/calendar_preload",this.MAX_COUNT=10},f=function(t){Object(u.a)(a,t);var e=Object(l.a)(a);function a(t){var n;return Object(c.a)(this,a),(n=e.call(this,t)).state={},n}return Object(o.a)(a,[{key:"componentDidMount",value:function(){this.getNameCityFrom(),this.getNameCityTo(),this.getDate(),this.currencyEx(),this.getChanges(),this.getLinkAviasales()}},{key:"componentDidUpdate",value:function(t){this.props.data!==t.data&&(this.getNameCityFrom(),this.getNameCityTo(),this.getDate(),this.currencyEx(),this.getChanges(),this.getLinkAviasales())}},{key:"getChanges",value:function(){switch(this.props.data.number_of_changes){case 1:this.setState({transfer:"\u0421 \u043e\u0434\u043d\u043e\u0439 \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043a\u043e\u0439"});break;case 2:this.setState({transfer:"\u0421 \u0434\u0432\u0443\u043c\u044f \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043a\u0430\u043c\u0438"});break;case 3:this.setState({transfer:"\u0421 \u0442\u0440\u0435\u043c\u044f \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043a\u0430\u043c\u0438"});break;default:this.setState({transfer:"\u0411\u0435\u0437 \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043e\u043a"})}}},{key:"getDate",value:function(){var t=new Date(this.props.data.depart_date).toLocaleString("ru",{year:"numeric",month:"long",day:"numeric"});this.setState({date:t})}},{key:"getLinkAviasales",value:function(){var t="https://www.aviasales.ua/search/";t+=this.props.data.origin;var e=new Date(this.props.data.depart_date),a=e.getDate();t+=a<10?"0"+a:a;var n=e.getMonth();t+=n<10?"0"+n:n,t+=this.props.data.destination,t+="1",this.setState({link:t})}},{key:"getNameCityFrom",value:function(){var t=this,e=this.props.city.find((function(e){return e.code===t.props.data.origin}));this.setState({cityNameFrom:e.name}),console.log(this.state.cityNameFrom)}},{key:"getNameCityTo",value:function(){var t=this,e=this.props.city.find((function(e){return e.code===t.props.data.destination}));this.setState({cityNameTo:e.name}),console.log(this.state.cityNameTo)}},{key:"currencyEx",value:function(){var t=(this.props.data.value/2.6).toFixed(2);this.setState({exch:t})}},{key:"render",value:function(){return r.a.createElement("div",{className:"card_ticket"},r.a.createElement("h3",{className:"agent"},this.props.data.gate),r.a.createElement("div",{className:"ticket__wrapper"},r.a.createElement("div",{className:"left-side"},r.a.createElement("a",{href:this.state.link,className:"button button__buy"},"\u041a\u0443\u043f\u0438\u0442\u044c \u0437\u0430\xa0",this.state.exch,"\u20b4")),r.a.createElement("div",{className:"right-side"},r.a.createElement("div",{className:"block-left"},r.a.createElement("div",{className:"city__from"},"\u0412\u044b\u043b\u0435\u0442 \u0438\u0437 \u0433\u043e\u0440\u043e\u0434\u0430:",r.a.createElement("span",{className:"city__name"},this.state.cityNameFrom)),r.a.createElement("div",{className:"date"},this.state.date)),r.a.createElement("div",{className:"block-right"},r.a.createElement("div",{className:"changes"},this.state.transfer),r.a.createElement("div",{className:"city__to"},"\u0413\u043e\u0440\u043e\u0434 \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f:",r.a.createElement("span",{className:"city__name"},this.state.cityNameTo))))))}}]),a}(n.Component),y=function(t){Object(u.a)(a,t);var e=Object(l.a)(a);function a(t){var n;return Object(c.a)(this,a),(n=e.call(this,t)).onCityLoaded=function(t){n.setState({city:t})},n.showCityFrom=function(){var t=document.querySelector(".dropdown__cities-from");(t.textContent="",""!==n.state.origin)&&n.state.city.filter((function(t){return t.name.toLowerCase().startsWith(n.state.origin.toLowerCase())})).forEach((function(e){var a=document.createElement("li");a.classList.add("dropdown__city"),a.textContent=e.name,t.append(a)}))},n.showCityTo=function(){var t=document.querySelector(".dropdown__cities-to");(t.textContent="",""!==n.state.destination)&&n.state.city.filter((function(t){return t.name.toLowerCase().startsWith(n.state.destination.toLowerCase())})).forEach((function(e){var a=document.createElement("li");a.classList.add("dropdown__city"),a.textContent=e.name,t.append(a)}))},n.selectCityFrom=function(t){var e=document.querySelector(".dropdown__cities-from"),a=t.target;"li"===a.tagName.toLowerCase()&&(n.setState({origin:a.textContent}),e.textContent="")},n.selectCityTo=function(t){var e=document.querySelector(".dropdown__cities-to"),a=t.target;"li"===a.tagName.toLowerCase()&&(n.setState({destination:a.textContent}),e.textContent="")},n.onOriginChange=function(t){n.setState({origin:t.target.value})},n.onDestinationChange=function(t){n.setState({destination:t.target.value})},n.departureDateChange=function(t){n.setState({setDepartureDate:t.target.value})},n.renderCheap=function(t,e){var a=t.best_prices.filter((function(t){return t.depart_date===e}))[0];n.setState({cheapTicket:a});var r=document.getElementById("cheapest-ticket"),i=document.querySelector(".wrapper__ticket>h2");n.state.cheapTicket&&r&&(i.textContent="\u0421\u0430\u043c\u044b\u0439 \u0434\u0435\u0448\u0435\u0432\u044b\u0439 \u0431\u0438\u043b\u0435\u0442 \u043d\u0430 \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0434\u0430\u0442\u0443",r.style.display="block"),void 0===n.state.cheapTicket&&(r.style.display="block",i.textContent="\u0418\u0437\u0432\u0438\u043d\u0438\u0442\u0435, \u043f\u043e \u044d\u0442\u043e\u043c\u0443 \u043d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044e \u043d\u0435\u0442 \u0431\u0438\u043b\u0435\u0442\u043e\u0432")},n.renderCardCheap=function(t){return r.a.createElement(f,{data:t,city:n.state.city})},n.onSearchFlights=function(t){t.preventDefault();var e={from:n.state.city.find((function(t){return n.state.origin===t.name})),to:n.state.city.find((function(t){return n.state.destination===t.name})),when:n.state.setDepartureDate};if(e.from&&e.to){var a="?depart_date=".concat(e.when,"&origin=").concat(e.from.code,"&destination=").concat(e.to.code,"&one_way=true&token=").concat(n.API_KEY);n.SearchService.getPrice(a).then((function(t){n.renderCheap(t,e.when)}))}else alert("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0433\u043e\u0440\u043e\u0434\u0430")},n.SearchService=new p,n.state={origin:"",destination:"",setDepartureDate:"",city:[]},n}return Object(o.a)(a,[{key:"componentDidMount",value:function(){this.updateCity()}},{key:"updateCity",value:function(){this.SearchService.getCity().then(this.onCityLoaded)}},{key:"render",value:function(){var t=this.state.cheapTicket,e=this.renderCardCheap(t);return r.a.createElement(r.a.Fragment,null,r.a.createElement("section",{className:"wrapper"},r.a.createElement("form",{onSubmit:this.onSearchFlights,className:"form-search"},r.a.createElement("div",{className:"wrapper__search"},r.a.createElement("div",{className:"input",style:{display:"block"}},r.a.createElement("label",null,"\u041e\u0442\u043a\u0443\u0434\u0430",r.a.createElement("input",{type:"text",value:this.state.origin,onInput:this.showCityFrom,onChange:this.onOriginChange,className:"input__cities-from",required:!0})),r.a.createElement("ul",{onClick:this.selectCityFrom,className:"dropdown dropdown__cities-from"})),r.a.createElement("div",{className:"input"},r.a.createElement("label",null,"\u041a\u0443\u0434\u0430",r.a.createElement("input",{type:"text",value:this.state.destination,onInput:this.showCityTo,onChange:this.onDestinationChange,className:"input__cities-to",required:!0})),r.a.createElement("ul",{onClick:this.selectCityTo,className:"dropdown dropdown__cities-to"})),r.a.createElement("div",{className:"input input__cities-from"},r.a.createElement("label",null,"\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435",r.a.createElement("input",{type:"date",placeholder:"Departure date",onChange:this.departureDateChange,className:"input__date-depart",required:!0})))),r.a.createElement("div",{className:"wrapper__button"},r.a.createElement("button",{type:"submit",className:"button button__search"},r.a.createElement("span",{className:"button__search-text"},"\u041d\u0430\u0439\u0442\u0438 \u0431\u0438\u043b\u0435\u0442\u044b"))))),r.a.createElement("section",{className:"card-wrapper"},r.a.createElement("section",{className:"wrapper__ticket",id:"cheapest-ticket",style:{display:"none"}},r.a.createElement("h2",null),r.a.createElement("article",{className:"ticket"},this.state.cheapTicket?e:""))))}}]),a}(n.Component);function v(){return r.a.createElement("div",null,r.a.createElement("h1",{className:"text-center  p-3"},"\u0410\u0432\u0438\u0430\u0431\u0438\u043b\u0435\u0442\u044b"),r.a.createElement(y,null))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(v,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))},9:function(t,e,a){t.exports=a(17)}},[[9,1,2]]]);
//# sourceMappingURL=main.8bc36d68.chunk.js.map