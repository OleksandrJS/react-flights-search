(this["webpackJsonpreact-flight-search"]=this["webpackJsonpreact-flight-search"]||[]).push([[0],{17:function(e,t,a){e.exports=a(31)},29:function(e,t,a){},31:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(7),i=a.n(c),s=a(1),o=a(5),l=a(16),u=a(4),d=a(8),h=a(10),m=a(9),p=(a(28),a(29),a(2)),f=a.n(p),y=a(6),v=function e(){var t=this;Object(u.a)(this,e),this.getData=function(){var e=Object(y.a)(f.a.mark((function e(t){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:if((a=e.sent).ok){e.next=5;break}throw new Error("Could not fetch ".concat(t,"; received ").concat(a.status));case 5:return e.next=7,a.json();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getCity=Object(y.a)(f.a.mark((function e(){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getData(t.PROXY+t.CITY_API);case 2:return a=e.sent,e.abrupt("return",a.filter((function(e){return e.name})));case 4:case"end":return e.stop()}}),e)}))),this.CITY_API="http://api.travelpayouts.com/data/ru/cities.json",this.PROXY="https://cors-anywhere.herokuapp.com/"},_=function(){return r.a.createElement("div",{className:"loader-wrapper",role:"status"},r.a.createElement("div",{className:"spinner-border text-center text-primary pt-3",role:"status"},r.a.createElement("span",{className:"sr-only"},"Loading...")))},g=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this,e)).state={},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.getNameCityFrom(),this.getNameCityTo(),this.getDate(),this.currencyEx(),this.getChanges(),this.getLinkAviasales()}},{key:"componentDidUpdate",value:function(e){this.props.data!==e.data&&(this.getNameCityFrom(),this.getNameCityTo(),this.getDate(),this.currencyEx(),this.getChanges(),this.getLinkAviasales())}},{key:"getChanges",value:function(){switch(this.props.data.number_of_changes){case 1:this.setState({transfer:"\u0421 \u043e\u0434\u043d\u043e\u0439 \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043a\u043e\u0439"});break;case 2:this.setState({transfer:"\u0421 \u0434\u0432\u0443\u043c\u044f \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043a\u0430\u043c\u0438"});break;case 3:this.setState({transfer:"\u0421 \u0442\u0440\u0435\u043c\u044f \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043a\u0430\u043c\u0438"});break;default:this.setState({transfer:"\u0411\u0435\u0437 \u043f\u0435\u0440\u0435\u0441\u0430\u0434\u043e\u043a"})}}},{key:"getDate",value:function(){var e=new Date(this.props.data.depart_date).toLocaleString("ru",{year:"numeric",month:"long",day:"numeric"});this.setState({date:e})}},{key:"getLinkAviasales",value:function(){var e="https://www.aviasales.ua/search/";e+=this.props.data.origin;var t=new Date(this.props.data.depart_date),a=t.getDate();e+=a<10?"0"+a:a;var n=t.getMonth();e+=n<10?"0"+n:n,e+=this.props.data.destination,e+="1",this.setState({link:e})}},{key:"getNameCityFrom",value:function(){var e=this,t=this.props.city.find((function(t){return t.code===e.props.data.origin}));this.setState({cityNameFrom:t.name})}},{key:"getNameCityTo",value:function(){var e=this,t=this.props.city.find((function(t){return t.code===e.props.data.destination}));this.setState({cityNameTo:t.name})}},{key:"currencyEx",value:function(){var e=(this.props.data.value/2.6).toFixed(0);this.setState({exch:e})}},{key:"render",value:function(){var e=this.state,t=e.link,a=e.exch,n=e.cityNameFrom,c=e.cityNameTo,i=e.date,s=e.transfer;return this.props.loading?r.a.createElement("div",{className:"card_ticket text-center size"},r.a.createElement(_,null)):r.a.createElement("div",{className:"card_ticket"},r.a.createElement("h3",{className:"agent"},this.props.data.gate),r.a.createElement("div",{className:"ticket__wrapper"},r.a.createElement("div",{className:"left-side"},r.a.createElement("a",{href:t,className:"button button__buy"},"\u041a\u0443\u043f\u0438\u0442\u044c \u0437\u0430\xa0",a,"\u20b4")),r.a.createElement("div",{className:"right-side"},r.a.createElement("div",{className:"block-left"},r.a.createElement("div",{className:"city__from"},"\u0412\u044b\u043b\u0435\u0442 \u0438\u0437 \u0433\u043e\u0440\u043e\u0434\u0430:",r.a.createElement("span",{className:"city__name"},n)),r.a.createElement("div",{className:"date"},i)),r.a.createElement("div",{className:"block-right"},r.a.createElement("div",{className:"changes"},s),r.a.createElement("div",{className:"city__to"},"\u0413\u043e\u0440\u043e\u0434 \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f:",r.a.createElement("span",{className:"city__name"},c))))))}}]),a}(n.Component),E=Object(o.b)((function(e){return{loading:e.card.loading}}),null)(g);function C(){return{type:"CARD/HIDE_LOADER"}}var k=function(e){Object(h.a)(a,e);var t=Object(m.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this,e)).onCityLoaded=function(e){n.setState({city:e})},n.showCity=function(e,t){(t.textContent="",""!==e)&&n.state.city.filter((function(t){return t.name.toLowerCase().startsWith(e.toLowerCase())})).forEach((function(e){var a=document.createElement("li");a.classList.add("dropdown__city"),a.textContent=e.name,t.append(a)}))},n.selectCityFrom=function(e){var t=document.querySelector(".dropdown__cities-from"),a=e.target;"li"===a.tagName.toLowerCase()&&(n.setState({origin:a.textContent}),t.textContent="")},n.selectCityTo=function(e){var t=document.querySelector(".dropdown__cities-to"),a=e.target;"li"===a.tagName.toLowerCase()&&(n.setState({destination:a.textContent}),t.textContent="")},n.onOriginChange=function(e){n.setState({origin:e.target.value})},n.onDestinationChange=function(e){n.setState({destination:e.target.value})},n.departureDateChange=function(e){n.setState({setDepartureDate:e.target.value})},n.cheapestTicket=function(e){n.setState({cheapTicket:e});var t=document.getElementById("cheapest-ticket"),a=document.querySelector(".wrapper__ticket>h2");n.state.cheapTicket&&t&&(a.textContent="\u0421\u0430\u043c\u044b\u0439 \u0434\u0435\u0448\u0435\u0432\u044b\u0439 \u0431\u0438\u043b\u0435\u0442 \u043d\u0430 \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0434\u0430\u0442\u0443",t.style.display="block"),void 0===n.state.cheapTicket&&(t.style.display="block",a.textContent="\u0418\u0437\u0432\u0438\u043d\u0438\u0442\u0435, \u043d\u0435\u0442 \u0431\u0438\u043b\u0435\u0442\u043e\u0432 \u043d\u0430 \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u0443\u044e \u0434\u0430\u0442\u0443")},n.otherTickets=function(e){e.sort((function(e,t){return e.value-t.value})),e.splice(9,e.length-10);var t=document.getElementById("other-cheap-tickets"),a=document.querySelector(".block__ticket>h2");e.length>0?(n.setState({otherTicket:e}),n.state.otherTicket&&t&&(a.textContent="\u0421\u0430\u043c\u044b\u0435 \u0434\u0435\u0448\u0435\u0432\u044b\u0435 \u0431\u0438\u043b\u0435\u0442\u044b \u043d\u0430 \u0434\u0440\u0443\u0433\u0438\u0435 \u0434\u0430\u0442\u044b",t.style.display="block")):(t.style.display="block",a.textContent="\u0418\u0437\u0432\u0438\u043d\u0438\u0442\u0435, \u043f\u043e \u044d\u0442\u043e\u043c\u0443 \u043d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044e \u043d\u0435\u0442 \u0431\u0438\u043b\u0435\u0442\u043e\u0432")},n.renderCard=function(e,t){var a=e.best_prices,r=a.filter((function(e){return e.depart_date===t}))[0];n.cheapestTicket(r),n.otherTickets(a)},n.renderCardCheap=function(e){return r.a.createElement(E,{data:e,city:n.state.city})},n.renderOtherCheap=function(e){if(e)return e.map((function(e,t){return r.a.createElement(E,{data:e,city:n.state.city,key:t})}))},n.onSearchFlights=function(e){e.preventDefault(),n.setState({otherTicket:""});var t={from:n.state.city.find((function(e){return n.state.origin===e.name})),to:n.state.city.find((function(e){return n.state.destination===e.name})),when:n.state.setDepartureDate};if(t.from&&t.to){var a="?depart_date=".concat(t.when,"&origin=").concat(t.from.code,"&destination=").concat(t.to.code,"&one_way=true&token=").concat(n.API_KEY);new Promise((function(e){return e(n.props.fetchData(a))})).then((function(){return n.renderCard(n.props.fetchedPosts,t.when)})).then((function(){return setTimeout((function(){return n.props.hideLoader()}),300)}))}else alert("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0433\u043e\u0440\u043e\u0434\u0430")},n.SearchService=new v,n.MAX_COUNT=10,n.API_KEY="6af464c149023c58b81e81ab93488992",n.state={origin:"",destination:"",setDepartureDate:"",city:[]},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){this.updateCity(),this.hideCity()}},{key:"updateCity",value:function(){this.SearchService.getCity().then(this.onCityLoaded)}},{key:"hideCity",value:function(){document.querySelector("body").addEventListener("click",(function(e){var t=document.querySelector(".dropdown__cities-from"),a=document.querySelector(".dropdown__cities-to");e.target.closest(".form-search")||(t.textContent="",a.textContent="")}))}},{key:"render",value:function(){var e=document.querySelector(".dropdown__cities-from"),t=document.querySelector(".dropdown__cities-to"),a=this.state,n=a.cheapTicket,c=a.otherTicket,i=a.origin,s=a.destination,o=this.renderCardCheap(n),l=this.renderOtherCheap(c);return r.a.createElement(r.a.Fragment,null,r.a.createElement("section",{className:"wrapper"},r.a.createElement("form",{onSubmit:this.onSearchFlights,className:"form-search"},r.a.createElement("div",{className:"wrapper__search"},r.a.createElement("div",{className:"input",style:{display:"block"}},r.a.createElement("label",null,"\u041e\u0442\u043a\u0443\u0434\u0430",r.a.createElement("input",{type:"text",value:i,onInput:this.showCity.bind(this,i,e),onChange:this.onOriginChange,className:"input__cities-from",required:!0})),r.a.createElement("ul",{onClick:this.selectCityFrom,className:"dropdown dropdown__cities-from"})),r.a.createElement("div",{className:"input"},r.a.createElement("label",null,"\u041a\u0443\u0434\u0430",r.a.createElement("input",{type:"text",value:s,onInput:this.showCity.bind(this,s,t),onChange:this.onDestinationChange,className:"input__cities-to",required:!0})),r.a.createElement("ul",{onClick:this.selectCityTo,className:"dropdown dropdown__cities-to"})),r.a.createElement("div",{className:"input input__cities-from"},r.a.createElement("label",null,"\u041e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435",r.a.createElement("input",{type:"date",placeholder:"Departure date",onChange:this.departureDateChange,className:"input__date-depart",required:!0})))),r.a.createElement("div",{className:"wrapper__button"},r.a.createElement("button",{type:"submit",className:"button button__search"},r.a.createElement("span",{className:"button__search-text"},"\u041d\u0430\u0439\u0442\u0438 \u0431\u0438\u043b\u0435\u0442\u044b"))))),r.a.createElement("section",{className:"card-wrapper"},r.a.createElement("section",{className:"wrapper__ticket",id:"cheapest-ticket",style:{display:"none"}},r.a.createElement("h2",null),r.a.createElement("article",{className:"ticket"},n?o:null)),r.a.createElement("section",{className:"block__ticket",id:"other-cheap-tickets",style:{display:"none"}},r.a.createElement("h2",null),r.a.createElement("article",{className:"ticket"},c?l:null))))}}]),a}(n.Component),b={fetchData:function(e){return function(){var t=Object(y.a)(f.a.mark((function t(a){var n,r;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a({type:"CARD/SHOW_LOADER"}),t.next=4,fetch("https://min-prices.aviasales.ru/calendar_preload"+e);case 4:return n=t.sent,t.next=7,n.json();case 7:r=t.sent,a({type:"POST/FETCH_POSTS",payload:r}),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),a({type:"CARD/HIDE_LOADER"});case 14:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(e){return t.apply(this,arguments)}}()},hideLoader:C},w=Object(o.b)((function(e){return{fetchedPosts:e.post.fetchedPosts}}),b)(k);function N(){return r.a.createElement("div",null,r.a.createElement("h1",{className:"text-center  p-3"},"\u0410\u0432\u0438\u0430\u0431\u0438\u043b\u0435\u0442\u044b"),r.a.createElement(w,null))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var O=a(3),S={loading:!1},D={fetchedPosts:[]},x=Object(s.c)({card:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CARD/SHOW_LOADER":return Object(O.a)(Object(O.a)({},e),{},{loading:!0});case"CARD/HIDE_LOADER":return Object(O.a)(Object(O.a)({},e),{},{loading:!1});default:return e}},post:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"POST/FETCH_POSTS":return Object(O.a)(Object(O.a)({},e),{},{fetchedPosts:t.payload});default:return e}}}),T=Object(s.e)(x,Object(s.d)(Object(s.a)(l.a),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()));i.a.render(r.a.createElement(o.a,{store:T},r.a.createElement(r.a.StrictMode,null,r.a.createElement(N,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[17,1,2]]]);
//# sourceMappingURL=main.972daae6.chunk.js.map